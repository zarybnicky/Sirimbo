{% extends "Layout.twig" %}

{% block content %}
  <div class="container">
    {{ partnerRequest() }}
    <div class="mb-2">
      <a class="btn btn-outline-primary" href="/member/profil/edit">Upravit osobní údaje</a>
      <a class="btn btn-outline-primary" href="/member/profil/heslo">Změnit heslo</a>
      <a class="btn btn-outline-primary" href="/member/profil/par/partner">Změnit partnera</a>
      {% if coupleData.u_id %}
        <a class="btn btn-outline-primary" href="/member/profil/par/body">Změnit třídu a body</a>
      {% endif %}
      <a class="btn btn-outline-primary" href="/logout">Odhlásit se</a>
    </div>

  <div class="mb-2">
    Tréninková skupina:
    <div class="box" title="{{ skupina.description }}" style="background-color:{{ skupina.color }}"></div>
    &nbsp;{{ skupina.name }}<br>
    Věková kategorie: {{ ageGroup }}<br>
    Členské příspěvky: {{ hasPaid ? 'zaplaceno' : 'nezaplaceno' }}
  </div>

  {% if coupleData.u_id %}
    <h3>Pár</h3>
    <div class="mb-2">
      Partner(ka): {{ coupleData.u_jmeno }} {{ coupleData.u_prijmeni }}<br>
      Standardní tance:
      {{ coupleData.p_stt_trida }} {{ coupleData.p_stt_body }}, {{ coupleData.p_stt_finale }}F
      <br>
      Latinsko-americké tance:
      {{ coupleData.p_lat_trida }} {{ coupleData.p_lat_body }}, {{ coupleData.p_lat_finale }}F
    </div>
  {% endif %}

  {% if paymentsWanted %}
    <h3 class="mt-2">K zaplacení</h3>
    {% for item in paymentsWanted %}
      <div class="modal fade" id="qrModal-{{ item.id }}" tabindex="-1"
           role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">QR platba</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body d-flex align-items-center justify-content-center">
              {% set params = {
                  'acc': '1806875329/0800',
                  'am': item.amount,
                  'msg': user.fullName ~ ': ' ~ item.name,
                  'ss': item.symbol,
                  'vs': varSymbol,
              } %}
              <img alt="" src="/api/qr-payment.png?{{ params | url_encode }}" />
            </div>
          </div>
        </div>
      </div>
      <div class="card" style="max-width: 600px">
        <div class="card-body p-2">
          <div class="row">
            <div class="col-12 col-md-8 h5 mb-0">{{ item.name }}</div>
            <div class="col-12 col-md-4 text-right">do {{ item.dueDate }}</div>
          </div>
          <div class="row">
            <div class="col-12 col-md-8">{{ item.amount }} Kč</div>
            <div class="col-12 col-md-4 text-right">č.ú. 1806875329/0800</div>
          </div>
          <div class="row">
            <div class="col-12 col-md-6">
              <button type="button" class="btn btn-link p-0" data-toggle="modal"
                      data-target="#qrModal-{{ item.id }}">
                <img width="16" alt="QR platba" src="/style/icon-qr-code.png" style="vertical-align:text-top" />
                QR platba
              </button>
            </div>
            <div class="col-12 col-md-3">VS: {{ varSymbol }}</div>
            <div class="col-12 col-md-3 text-right">SS: {{ item.symbol }}</div>
          </div>
        </div>
      </div>
    {% endfor %}
  {% endif %}

  {% if paymentHistory %}
    <h3 class="mt-2">Historie plateb</h3>
    {{ table(paymentHistory, [
        ['name', 'Název'],
        ['varSymbol', 'Spec. symbol'],
        ['amount', 'Částka'],
        ['paidOn', 'Placeno'],
        ['validFor', 'Platí do'],
    ], ' style="width:100%"') }}
  {% endif %}
</div>
{% endblock %}

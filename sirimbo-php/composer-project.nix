# This file is generated by composer-plugin-nixify.
# Manual changes might be lost - proceed with caution!

{ lib, php, phpPackages, unzip, stdenv, runCommandLocal, writeText, fetchurl

# Default fetcher.
, fetcher ? (args: fetchurl { inherit (args) name urls sha256; })

}: src:

with lib;

let

  composerPath = phpPackages.composer.src;
  cacheEntries = [
    { name = "clue_stream-filter-1.5.0.0"; filename = "clue/stream-filter/7b548dde6ca13c7661a34c0f835df402b5e45b4f.zip"; sha256 = "55a21e09220e40d7aca4282e86bc199b832799b14210c2ae23cc127c2320a620"; urls = [ "https://api.github.com/repos/clue/stream-filter/zipball/aeb7d8ea49c7963d3b581378955dbf5bc49aa320" ]; }
    { name = "guzzlehttp_promises-1.4.1.0"; filename = "guzzlehttp/promises/a5f7f1a2da00e2e1a653a11af7383204345ac117.zip"; sha256 = "5864c9d8cb42991d11e472b5de806c17c3c6a724795222984183ee5d2d6a1c95"; urls = [ "https://api.github.com/repos/guzzle/promises/zipball/8e7d04f1f6450fef59366c399cfad4b9383aa30d" ]; }
    { name = "guzzlehttp_psr7-1.8.2.0"; filename = "guzzlehttp/psr7/ced319770e139c9665046a5cc08399b5266caa0f.zip"; sha256 = "3fd285acbca002457a2dc1e868699931670d270133df991065d34ce43830cc1a"; urls = [ "https://api.github.com/repos/guzzle/psr7/zipball/dc960a912984efb74d0a90222870c72c87f10c91" ]; }
    { name = "http-interop_http-factory-guzzle-1.0.0.0"; filename = "http-interop/http-factory-guzzle/a9f04be4a3b729b6d69f58b7d1b28fa51a7fd3f9.zip"; sha256 = "94e3b68a633432513dc68773f2af194b4414f5e8cab43d1949002dd3f26fc37f"; urls = [ "https://api.github.com/repos/http-interop/http-factory-guzzle/zipball/34861658efb9899a6618cef03de46e2a52c80fc0" ]; }
    { name = "jean85_pretty-package-versions-2.0.4.0"; filename = "jean85/pretty-package-versions/25e416de5a2000b85b1bdd1e85cc1ea81b43c6fb.zip"; sha256 = "8c0c48bb7a1635963bc8823b0acaf0a50990216c99083982fa596d884e015226"; urls = [ "https://api.github.com/repos/Jean85/pretty-package-versions/zipball/694492c653c518456af2805f04eec445b997ed1f" ]; }
    { name = "php-http_client-common-2.3.0.0"; filename = "php-http/client-common/616894a759f87ea6d0e449ea1ebc3619419deaca.zip"; sha256 = "703bc88d6325ac55ef80e59ab416258397c2c3546ba2b2c2a91b68afb5682342"; urls = [ "https://api.github.com/repos/php-http/client-common/zipball/e37e46c610c87519753135fb893111798c69076a" ]; }
    { name = "php-http_discovery-1.14.0.0"; filename = "php-http/discovery/38580b6f34e0c504db720e2bcd813a93926b6f37.zip"; sha256 = "e0221bc9c8067e13fbdfba91a56436f8067f1c55d2aaa51c80ab6f15fe66cbe5"; urls = [ "https://api.github.com/repos/php-http/discovery/zipball/778f722e29250c1fac0bbdef2c122fa5d038c9eb" ]; }
    { name = "php-http_httplug-2.2.0.0"; filename = "php-http/httplug/bfec9434234740f4f1d8da7380d550849e512973.zip"; sha256 = "a40b8cf25d5ad76ca8427680180e8f5c91b40a7a1e370a2434672dcb67540a28"; urls = [ "https://api.github.com/repos/php-http/httplug/zipball/191a0a1b41ed026b717421931f8d3bd2514ffbf9" ]; }
    { name = "php-http_message-1.11.1.0"; filename = "php-http/message/0874084b3dd4dcf89359add89697fb7597f6ab1c.zip"; sha256 = "04bad638594b2b600716111efa588ccf6f0dd65fdace152e4a6f71dbc790a3cb"; urls = [ "https://api.github.com/repos/php-http/message/zipball/887734d9c515ad9a564f6581a682fff87a6253cc" ]; }
    { name = "php-http_message-factory-1.0.2.0"; filename = "php-http/message-factory/3a0870f309cd6c659ea5925ef5a3d22e5203a375.zip"; sha256 = "9a1dfff8872c579bf8bd9e605d4d99579e3a5784fca4053e1463e03510bbb98d"; urls = [ "https://api.github.com/repos/php-http/message-factory/zipball/a478cb11f66a6ac48d8954216cfed9aa06a501a1" ]; }
    { name = "php-http_promise-1.1.0.0"; filename = "php-http/promise/83f5526bc8dced8abb54a7d772e34cadbff53fbe.zip"; sha256 = "7ff1fcd02530d3c97a2a38dd505d53469cb4d87075e59d52c952d36efacd5776"; urls = [ "https://api.github.com/repos/php-http/promise/zipball/4c4c1f9b7289a2ec57cde7f1e9762a5789506f88" ]; }
    { name = "psr_container-1.1.1.0"; filename = "psr/container/e4c7bcf51ae3971f12405fe5a14d36d5b2ddff27.zip"; sha256 = "9667379def7c9222ea036f8199ef905f31c42e2baafdb4a63927d23aaef3db61"; urls = [ "https://api.github.com/repos/php-fig/container/zipball/8622567409010282b7aeebe4bb841fe98b58dcaf" ]; }
    { name = "psr_http-client-1.0.1.0"; filename = "psr/http-client/9ef0ac1a0bb8280477e24c9232fac374ed3024ac.zip"; sha256 = "fb98c497fe0d21d34c55622f687766e22198037a3c073fec44394439948bb332"; urls = [ "https://api.github.com/repos/php-fig/http-client/zipball/2dfb5f6c5eff0e91e20e913f8c5452ed95b86621" ]; }
    { name = "psr_http-factory-1.0.1.0"; filename = "psr/http-factory/554dafa2f4680a78fa693cedcbe62bc6873809db.zip"; sha256 = "baedc0aa21248f8a0316a8b78c98754cf7c4b3fe8ab7a4da5ad0adc22eb6cb46"; urls = [ "https://api.github.com/repos/php-fig/http-factory/zipball/12ac7fcd07e5b077433f5f2bee95b3a771bf61be" ]; }
    { name = "psr_http-message-1.0.1.0"; filename = "psr/http-message/cc1d4e9ee13f2053b80c08976256789bf3be5256.zip"; sha256 = "8538467ca2665fe15574f4d2506871823f71fd24b9a9284aae2ba90d8f69ada4"; urls = [ "https://api.github.com/repos/php-fig/http-message/zipball/f6561bf28d520154e4b0ec72be95418abe6d9363" ]; }
    { name = "psr_log-1.1.4.0"; filename = "psr/log/73bdffd901b564d0a2f7244baecb66a2572fcfc4.zip"; sha256 = "965685486b2439218c456e8ad399957891e508ec836f6cf56bbfee0606ae6069"; urls = [ "https://api.github.com/repos/php-fig/log/zipball/d49695b909c3b7628b6289db5479a1c204601f11" ]; }
    { name = "ralouphie_getallheaders-3.0.3.0"; filename = "ralouphie/getallheaders/ddc5f4c7ab3d868f5060717336a0d93475d53175.zip"; sha256 = "ef0165da5690da666ab4cb88bb4cec0d50372e3e7c922532c5795a3567b367af"; urls = [ "https://api.github.com/repos/ralouphie/getallheaders/zipball/120b605dfeb996808c31b6477290a714d356e822" ]; }
    { name = "sentry_sdk-3.1.0.0"; filename = "sentry/sdk/b25f75b05433eb6338cd15838afe1679b58d9132.zip"; sha256 = "f052beb59bb0aac14324801537d40e763dd7e580d5a1d9456d37180b66f9fc3c"; urls = [ "https://api.github.com/repos/getsentry/sentry-php-sdk/zipball/f03133b067fdf03fed09ff03daf3f1d68f5f3673" ]; }
    { name = "sentry_sentry-3.3.0.0"; filename = "sentry/sentry/2145ffe8a9f3916602697a1512e5b60da38587b0.zip"; sha256 = "20feecf4cc515a9d3bfb0404c6aae19c8083e00c2221fa3da4d8900ea8d8dc70"; urls = [ "https://api.github.com/repos/getsentry/sentry-php/zipball/3bb122f9fc2bc43a4646e37db79eaf115b35b047" ]; }
    { name = "stephank_composer-plugin-nixify-1.0.5.0"; filename = "stephank/composer-plugin-nixify/834cbda20610489fb40a56e04b4958ced883e937.zip"; sha256 = "155098d53ec086f0c382f14dd7634909b55adf291bebb4f7c308b8ac399f3cf2"; urls = [ "https://api.github.com/repos/stephank/composer-plugin-nixify/zipball/36754a374cbd3e9fa788b80fa64f224708b8a010" ]; }
    { name = "symfony_deprecation-contracts-2.4.0.0"; filename = "symfony/deprecation-contracts/f67cf4488adc23dd307c85c6422649cacfe19d03.zip"; sha256 = "e3aecaddecfd4562ebe6ee8c4793504bad52b4c1d33f87d091e09a9536526686"; urls = [ "https://api.github.com/repos/symfony/deprecation-contracts/zipball/5f38c8804a9e97d23e0c8d63341088cd8a22d627" ]; }
    { name = "symfony_http-client-5.3.0.0"; filename = "symfony/http-client/52f2cdcb2f570fe700686a1dbb3cea50ea124933.zip"; sha256 = "bc597c38248bd69d5450611cf19aafbb274d9fabd4c60780b0fc5ff4aca2c935"; urls = [ "https://api.github.com/repos/symfony/http-client/zipball/ef85ca5fa7a4f9c57592fab49faeccdf22b13136" ]; }
    { name = "symfony_http-client-contracts-2.4.0.0"; filename = "symfony/http-client-contracts/c0e86dfc3eb9d9a5beae180bf6cb5707b185af8c.zip"; sha256 = "0c0f616d5a9de6bcfb72b151fb3184d8cd62dc85bf63ce80961d789256fdba12"; urls = [ "https://api.github.com/repos/symfony/http-client-contracts/zipball/7e82f6084d7cae521a75ef2cb5c9457bbda785f4" ]; }
    { name = "symfony_options-resolver-5.3.0.0"; filename = "symfony/options-resolver/5b10074577546d579b3f83d6af04020bd06e13de.zip"; sha256 = "49d6ed632b311817e77f7d7e628ebd9fc3f44bd54dd76453b22e14f2ee44ced8"; urls = [ "https://api.github.com/repos/symfony/options-resolver/zipball/162e886ca035869866d233a2bfef70cc28f9bbe5" ]; }
    { name = "symfony_polyfill-ctype-1.23.0.0"; filename = "symfony/polyfill-ctype/2069808ba5d1fde65215fcd21f066a556e8d599e.zip"; sha256 = "f68331b082c7685aa3b09c4e081cbfdc72c0ccc23847a2bb3899e8deed8f917c"; urls = [ "https://api.github.com/repos/symfony/polyfill-ctype/zipball/46cd95797e9df938fdd2b03693b5fca5e64b01ce" ]; }
    { name = "symfony_polyfill-mbstring-1.23.0.0"; filename = "symfony/polyfill-mbstring/9a87412d2933063cce824959b7a150f24feb3fbe.zip"; sha256 = "d656fbaa602a654dbd5c9b443a40c7e81b3c8d4992bdd16300d61a45ee0871b9"; urls = [ "https://api.github.com/repos/symfony/polyfill-mbstring/zipball/2df51500adbaebdc4c38dea4c89a2e131c45c8a1" ]; }
    { name = "symfony_polyfill-php73-1.23.0.0"; filename = "symfony/polyfill-php73/5a8c1da207d5f69b6a997915e8aa5e320f2600ef.zip"; sha256 = "30d882f8a7732e9b86cf0c506a2ee26b420efa6efccfcdbec82a221e81698139"; urls = [ "https://api.github.com/repos/symfony/polyfill-php73/zipball/fba8933c384d6476ab14fb7b8526e5287ca7e010" ]; }
    { name = "symfony_polyfill-php80-1.23.0.0"; filename = "symfony/polyfill-php80/e87e3882cf80a2f35920731756a3154034b9f2ee.zip"; sha256 = "2abfe0361012b90d465eb082c06b8ae5a192d610b73fdaa4e74024883761b3f8"; urls = [ "https://api.github.com/repos/symfony/polyfill-php80/zipball/eca0bf41ed421bed1b57c4958bab16aa86b757d0" ]; }
    { name = "symfony_polyfill-uuid-1.23.0.0"; filename = "symfony/polyfill-uuid/c7d93058290c2edf17654838be37c47b4f5e3bb0.zip"; sha256 = "8f73043a4b380d412288d1593c687823475f14319441b71d4457cc3fae9ff9cb"; urls = [ "https://api.github.com/repos/symfony/polyfill-uuid/zipball/9165effa2eb8a31bb3fa608df9d529920d21ddd9" ]; }
    { name = "symfony_service-contracts-2.4.0.0"; filename = "symfony/service-contracts/3dd4e5719fb30b81c34fc430d62a901e9095cd70.zip"; sha256 = "3e6c0e0b3831b43c46b8ef84ddd3f549bcadc724ecf1976d526330a96a1ea7c4"; urls = [ "https://api.github.com/repos/symfony/service-contracts/zipball/f040a30e04b57fbcc9c6cbcf4dbaa96bd318b9bb" ]; }
    { name = "twig_twig-3.3.2.0"; filename = "twig/twig/50d77528a2e2cfb4be54997d34a02dc708d180a6.zip"; sha256 = "1d6b7aa4329d85c359caf7769c274dbde06773c5ba82240f90ff2cbd8ee50740"; urls = [ "https://api.github.com/repos/twigphp/Twig/zipball/21578f00e83d4a82ecfa3d50752b609f13de6790" ]; }
    { name = "ocramius_package-versions-1.11.0.0"; filename = "ocramius/package-versions/b600bd269224cfd4742d2e5f5000a6518eca5e13.zip"; sha256 = "ef18f8ba843cc31d70e828c91a27d260303fa1462e6e2512eb848ebeec216615"; urls = [ "https://api.github.com/repos/Ocramius/PackageVersions/zipball/f51ff2b2b49baaa302d6bf71880e4d8b5acd7015" ]; }
    { name = "sserbin_twig-linter-9999999-dev"; filename = "sserbin/twig-linter/c64f6c6563a7d658dd5ece34d782f463152dc278.zip"; sha256 = "3cb1e0921b7cbc732050c2b62b1b3bc7088b1ffed9646353f80a6bf7d428eb51"; urls = [ "https://api.github.com/repos/sserbin/twig-linter/zipball/7908885969d1110065fffddf4524ba56c96e1bc5" ]; }
    { name = "symfony_console-5.3.0.0"; filename = "symfony/console/7572669b904da59e99d886f49b650b238fb9a1ed.zip"; sha256 = "9cae1792e287a2fcc978a7fb74045f0749f04e926f2d722fd934ce79d0447a33"; urls = [ "https://api.github.com/repos/symfony/console/zipball/058553870f7809087fa80fa734704a21b9bcaeb2" ]; }
    { name = "symfony_finder-5.3.0.0"; filename = "symfony/finder/2cdc8f035503d0e305224a5ad34de7c0c44f501e.zip"; sha256 = "d5381bd77ce45a2a7bfe49ce584e16389fbdf60c05b0955e38a32b5c66e7fe3c"; urls = [ "https://api.github.com/repos/symfony/finder/zipball/0ae3f047bed4edff6fd35b26a9a6bfdc92c953c6" ]; }
    { name = "symfony_polyfill-intl-grapheme-1.23.0.0"; filename = "symfony/polyfill-intl-grapheme/7f7db4d5d1bee37cf0de0012ec40c81991631e18.zip"; sha256 = "c39d53a7193da41316ec11f863a32b6bb53e4dc1e18fbc85ac059529b2deafb5"; urls = [ "https://api.github.com/repos/symfony/polyfill-intl-grapheme/zipball/24b72c6baa32c746a4d0840147c9715e42bb68ab" ]; }
    { name = "symfony_polyfill-intl-normalizer-1.23.0.0"; filename = "symfony/polyfill-intl-normalizer/ff87d413e80cc4de92c8063abce356b5b870b37c.zip"; sha256 = "036a4eaf320e52e8f987ac6c134c9c1cc362efedf445e5d7130d60006cecc0b0"; urls = [ "https://api.github.com/repos/symfony/polyfill-intl-normalizer/zipball/8590a5f561694770bdcd3f9b5c69dde6945028e8" ]; }
    { name = "symfony_string-5.3.0.0"; filename = "symfony/string/3156ac2e0067789223bffb109acafb6f19ec56d0.zip"; sha256 = "88b88bf15b282b2f683a5aa160bd16e8349c9b5bdc88c751ed045bc79d121770"; urls = [ "https://api.github.com/repos/symfony/string/zipball/a9a0f8b6aafc5d2d1c116dcccd1573a95153515b" ]; }
  ];

  # Shell snippet to collect all project dependencies.
  collectCacheScript = writeText "collect-cache.sh" (
    concatMapStrings (args: ''
      (
        cacheFile=${escapeShellArg args.filename}
        cacheFilePath="$COMPOSER_CACHE_DIR/files/$cacheFile"
        mkdir -p "$(dirname "$cacheFilePath")"
        cp ${escapeShellArg (fetcher args)} "$cacheFilePath"
      )
    '') cacheEntries
  );

in stdenv.mkDerivation {
  name = "zarybnicky_tkolymp.cz";
  inherit src;

  # Make sure the build uses the right PHP version everywhere.
  # Also include unzip for Composer.
  buildInputs = [ php unzip ];

  # Defines the shell alias to run Composer.
  postHook = ''
    composer () {
      php "$NIX_COMPOSER_PATH" "$@"
    }
  '';

  configurePhase = ''
    runHook preConfigure

    # Set the cache directory for Composer.
    export COMPOSER_CACHE_DIR="$NIX_BUILD_TOP/.composer/cache"

    # Build the cache directory contents.
    source ${collectCacheScript}

    # Store the absolute path to Composer for the 'composer' alias.
    export NIX_COMPOSER_PATH="$(readlink -f ${escapeShellArg composerPath})"

    # Run normal Composer install to complete dependency installation.
    composer install

    runHook postConfigure
  '';

  buildPhase = ''
    runHook preBuild
    runHook postBuild
  '';

  installPhase = ''
    runHook preInstall

    mkdir -p $out/libexec $out/bin

    # Move the entire project to the output directory.
    mv $PWD "$out/libexec/$sourceRoot"
    cd "$out/libexec/$sourceRoot"

    # Update the path to Composer.
    export NIX_COMPOSER_PATH="$(readlink -f ${escapeShellArg composerPath})"

    # Invoke a plugin internal command to setup binaries.
    composer nixify-install-bin "$out/bin"

    runHook postInstall
  '';

  passthru = {
    inherit php;
  };
}

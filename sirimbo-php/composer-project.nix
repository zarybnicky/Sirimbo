# This file is generated by composer-plugin-nixify.
# Manual changes might be lost - proceed with caution!

{ lib, php, phpPackages, unzip, stdenv, runCommandLocal, writeText, fetchurl

# Default fetcher.
, fetcher ? (args: fetchurl { inherit (args) name urls sha256; })

}: src:

with lib;

let

  composerPath = phpPackages.composer.src;
  cacheEntries = [
    { name = "clue_stream-filter-1.5.0.0"; filename = "clue/stream-filter/a4f28fbf88f3eba5fb4206cff4398df5fcacffa2.zip"; sha256 = "ff35d649bca375d6d0a6eba649e2f62a06f0f0ef36d443b516ad678176cc78fc"; urls = [ "https://nexus.inuits.io/repository/composer/clue/stream-filter/v1.5.0/clue-stream-filter-v1.5.0.zip" ]; }
    { name = "composer_package-versions-deprecated-1.11.99.2"; filename = "composer/package-versions-deprecated/12ce492e1ca0ab994b768ab7b6c2f8a7a3f5e81e.zip"; sha256 = "1240108d22a726b8b1395ad57230c83c656cf11e5307dfdb7898077f1600c545"; urls = [ "https://nexus.inuits.io/repository/composer/composer/package-versions-deprecated/1.11.99.2/composer-package-versions-deprecated-1.11.99.2.zip" ]; }
    { name = "guzzlehttp_promises-1.4.1.0"; filename = "guzzlehttp/promises/83dbfac3d32386d0b23f1e790852fedb219458f8.zip"; sha256 = "5864c9d8cb42991d11e472b5de806c17c3c6a724795222984183ee5d2d6a1c95"; urls = [ "https://nexus.inuits.io/repository/composer/guzzlehttp/promises/1.4.1/guzzlehttp-promises-1.4.1.zip" ]; }
    { name = "guzzlehttp_psr7-1.8.2.0"; filename = "guzzlehttp/psr7/38cc0cad9665cb54bd76a5561fc752a9668aff43.zip"; sha256 = "3fd285acbca002457a2dc1e868699931670d270133df991065d34ce43830cc1a"; urls = [ "https://nexus.inuits.io/repository/composer/guzzlehttp/psr7/1.8.2/guzzlehttp-psr7-1.8.2.zip" ]; }
    { name = "http-interop_http-factory-guzzle-1.0.0.0"; filename = "http-interop/http-factory-guzzle/1c3f18d21da96c21d8ed71e407d888b91448fd03.zip"; sha256 = "94e3b68a633432513dc68773f2af194b4414f5e8cab43d1949002dd3f26fc37f"; urls = [ "https://nexus.inuits.io/repository/composer/http-interop/http-factory-guzzle/1.0.0/http-interop-http-factory-guzzle-1.0.0.zip" ]; }
    { name = "jean85_pretty-package-versions-1.6.0.0"; filename = "jean85/pretty-package-versions/4cf261089ccb0ced91de97c998ad899129573eec.zip"; sha256 = "2dbca18308572874be4430aba1fc3fa31140fa9a0e9e2f77a14fa54480cf3fa5"; urls = [ "https://nexus.inuits.io/repository/composer/jean85/pretty-package-versions/1.6.0/jean85-pretty-package-versions-1.6.0.zip" ]; }
    { name = "php-http_client-common-2.3.0.0"; filename = "php-http/client-common/987d249ad24fae1371eb5f5c80f16099b874c457.zip"; sha256 = "703bc88d6325ac55ef80e59ab416258397c2c3546ba2b2c2a91b68afb5682342"; urls = [ "https://nexus.inuits.io/repository/composer/php-http/client-common/2.3.0/php-http-client-common-2.3.0.zip" ]; }
    { name = "php-http_discovery-1.14.0.0"; filename = "php-http/discovery/c26ba2f7e16f59cdb6d9b30f45dae4af56e0caaf.zip"; sha256 = "e0221bc9c8067e13fbdfba91a56436f8067f1c55d2aaa51c80ab6f15fe66cbe5"; urls = [ "https://nexus.inuits.io/repository/composer/php-http/discovery/1.14.0/php-http-discovery-1.14.0.zip" ]; }
    { name = "php-http_httplug-2.2.0.0"; filename = "php-http/httplug/b9cc79682914dd35621d588fb198fa7cce3ea1a1.zip"; sha256 = "a40b8cf25d5ad76ca8427680180e8f5c91b40a7a1e370a2434672dcb67540a28"; urls = [ "https://nexus.inuits.io/repository/composer/php-http/httplug/2.2.0/php-http-httplug-2.2.0.zip" ]; }
    { name = "php-http_message-1.11.1.0"; filename = "php-http/message/6dbfddf7de4f1444603ebf4dbea5e48f809e264d.zip"; sha256 = "04bad638594b2b600716111efa588ccf6f0dd65fdace152e4a6f71dbc790a3cb"; urls = [ "https://nexus.inuits.io/repository/composer/php-http/message/1.11.1/php-http-message-1.11.1.zip" ]; }
    { name = "php-http_message-factory-1.0.2.0"; filename = "php-http/message-factory/a444851e70293c972ec0c08dd54ba7363d788ff3.zip"; sha256 = "9a1dfff8872c579bf8bd9e605d4d99579e3a5784fca4053e1463e03510bbb98d"; urls = [ "https://nexus.inuits.io/repository/composer/php-http/message-factory/v1.0.2/php-http-message-factory-v1.0.2.zip" ]; }
    { name = "php-http_promise-1.1.0.0"; filename = "php-http/promise/ea829fb4dc3ea30a40f2175275a89b7e4c94905d.zip"; sha256 = "7ff1fcd02530d3c97a2a38dd505d53469cb4d87075e59d52c952d36efacd5776"; urls = [ "https://nexus.inuits.io/repository/composer/php-http/promise/1.1.0/php-http-promise-1.1.0.zip" ]; }
    { name = "psr_container-1.1.1.0"; filename = "psr/container/e9bac4c8bdeeacc83dc4a816d7df1ee775d1e9c3.zip"; sha256 = "9667379def7c9222ea036f8199ef905f31c42e2baafdb4a63927d23aaef3db61"; urls = [ "https://nexus.inuits.io/repository/composer/psr/container/1.1.1/psr-container-1.1.1.zip" ]; }
    { name = "psr_http-client-1.0.1.0"; filename = "psr/http-client/5bb63ebb77a3c9009f095b3f688dcdfd03a9f544.zip"; sha256 = "fb98c497fe0d21d34c55622f687766e22198037a3c073fec44394439948bb332"; urls = [ "https://nexus.inuits.io/repository/composer/psr/http-client/1.0.1/psr-http-client-1.0.1.zip" ]; }
    { name = "psr_http-factory-1.0.1.0"; filename = "psr/http-factory/3f764c4696a6363c4875c8b17c23f670204b1219.zip"; sha256 = "baedc0aa21248f8a0316a8b78c98754cf7c4b3fe8ab7a4da5ad0adc22eb6cb46"; urls = [ "https://nexus.inuits.io/repository/composer/psr/http-factory/1.0.1/psr-http-factory-1.0.1.zip" ]; }
    { name = "psr_http-message-1.0.1.0"; filename = "psr/http-message/8e69010a405a419431f24312f865a5aea6fa6d5d.zip"; sha256 = "8538467ca2665fe15574f4d2506871823f71fd24b9a9284aae2ba90d8f69ada4"; urls = [ "https://nexus.inuits.io/repository/composer/psr/http-message/1.0.1/psr-http-message-1.0.1.zip" ]; }
    { name = "psr_log-1.1.4.0"; filename = "psr/log/d36c427f62b3af1cf64dc10a9ce34efac370826c.zip"; sha256 = "965685486b2439218c456e8ad399957891e508ec836f6cf56bbfee0606ae6069"; urls = [ "https://nexus.inuits.io/repository/composer/psr/log/1.1.4/psr-log-1.1.4.zip" ]; }
    { name = "ralouphie_getallheaders-3.0.3.0"; filename = "ralouphie/getallheaders/4a65b2990ec23d741c36b09d6831930316d62fd4.zip"; sha256 = "ef0165da5690da666ab4cb88bb4cec0d50372e3e7c922532c5795a3567b367af"; urls = [ "https://nexus.inuits.io/repository/composer/ralouphie/getallheaders/3.0.3/ralouphie-getallheaders-3.0.3.zip" ]; }
    { name = "sentry_sdk-3.1.0.0"; filename = "sentry/sdk/2b3690d8b32cad4dd3051fd5d800305bb546df6d.zip"; sha256 = "f052beb59bb0aac14324801537d40e763dd7e580d5a1d9456d37180b66f9fc3c"; urls = [ "https://nexus.inuits.io/repository/composer/sentry/sdk/3.1.0/sentry-sdk-3.1.0.zip" ]; }
    { name = "sentry_sentry-3.3.0.0"; filename = "sentry/sentry/411c071be05fffe6ab144491f6827b970ed8b20d.zip"; sha256 = "20feecf4cc515a9d3bfb0404c6aae19c8083e00c2221fa3da4d8900ea8d8dc70"; urls = [ "https://nexus.inuits.io/repository/composer/sentry/sentry/3.3.0/sentry-sentry-3.3.0.zip" ]; }
    { name = "stephank_composer-plugin-nixify-1.0.5.0"; filename = "stephank/composer-plugin-nixify/e2a1020a7b33878e01d46dacea0674500d4a711e.zip"; sha256 = "155098d53ec086f0c382f14dd7634909b55adf291bebb4f7c308b8ac399f3cf2"; urls = [ "https://nexus.inuits.io/repository/composer/stephank/composer-plugin-nixify/v1.0.5/stephank-composer-plugin-nixify-v1.0.5.zip" ]; }
    { name = "symfony_deprecation-contracts-2.4.0.0"; filename = "symfony/deprecation-contracts/0d06432f6822f3e476e34d2b8d7c1f7132b93950.zip"; sha256 = "e3aecaddecfd4562ebe6ee8c4793504bad52b4c1d33f87d091e09a9536526686"; urls = [ "https://nexus.inuits.io/repository/composer/symfony/deprecation-contracts/v2.4.0/symfony-deprecation-contracts-v2.4.0.zip" ]; }
    { name = "symfony_http-client-5.3.0.0"; filename = "symfony/http-client/645bc74642dfb9edd99abb6de115b1e6d7f578aa.zip"; sha256 = "bc597c38248bd69d5450611cf19aafbb274d9fabd4c60780b0fc5ff4aca2c935"; urls = [ "https://nexus.inuits.io/repository/composer/symfony/http-client/v5.3.0/symfony-http-client-v5.3.0.zip" ]; }
    { name = "symfony_http-client-contracts-2.4.0.0"; filename = "symfony/http-client-contracts/2acf42eab47f394205bf9e79f10cd0c6cf66931a.zip"; sha256 = "0c0f616d5a9de6bcfb72b151fb3184d8cd62dc85bf63ce80961d789256fdba12"; urls = [ "https://nexus.inuits.io/repository/composer/symfony/http-client-contracts/v2.4.0/symfony-http-client-contracts-v2.4.0.zip" ]; }
    { name = "symfony_options-resolver-5.3.0.0"; filename = "symfony/options-resolver/95d4f0ae4abcb5eb851867dcce77e13af1328ea3.zip"; sha256 = "49d6ed632b311817e77f7d7e628ebd9fc3f44bd54dd76453b22e14f2ee44ced8"; urls = [ "https://nexus.inuits.io/repository/composer/symfony/options-resolver/v5.3.0/symfony-options-resolver-v5.3.0.zip" ]; }
    { name = "symfony_polyfill-ctype-1.23.0.0"; filename = "symfony/polyfill-ctype/250a2403ca86909114445cd88535d81ff540bcf3.zip"; sha256 = "f68331b082c7685aa3b09c4e081cbfdc72c0ccc23847a2bb3899e8deed8f917c"; urls = [ "https://nexus.inuits.io/repository/composer/symfony/polyfill-ctype/v1.23.0/symfony-polyfill-ctype-v1.23.0.zip" ]; }
    { name = "symfony_polyfill-mbstring-1.23.0.0"; filename = "symfony/polyfill-mbstring/772c438273718cbb35a443c619ab500dbff3a63d.zip"; sha256 = "d656fbaa602a654dbd5c9b443a40c7e81b3c8d4992bdd16300d61a45ee0871b9"; urls = [ "https://nexus.inuits.io/repository/composer/symfony/polyfill-mbstring/v1.23.0/symfony-polyfill-mbstring-v1.23.0.zip" ]; }
    { name = "symfony_polyfill-php73-1.23.0.0"; filename = "symfony/polyfill-php73/75f14af34189d53aefa811ff2f29f2392bb0ac65.zip"; sha256 = "30d882f8a7732e9b86cf0c506a2ee26b420efa6efccfcdbec82a221e81698139"; urls = [ "https://nexus.inuits.io/repository/composer/symfony/polyfill-php73/v1.23.0/symfony-polyfill-php73-v1.23.0.zip" ]; }
    { name = "symfony_polyfill-php80-1.23.0.0"; filename = "symfony/polyfill-php80/df20c975a4f2fc15799bbc3b4a778ba1033ef120.zip"; sha256 = "2abfe0361012b90d465eb082c06b8ae5a192d610b73fdaa4e74024883761b3f8"; urls = [ "https://nexus.inuits.io/repository/composer/symfony/polyfill-php80/v1.23.0/symfony-polyfill-php80-v1.23.0.zip" ]; }
    { name = "symfony_polyfill-uuid-1.23.0.0"; filename = "symfony/polyfill-uuid/e10a5d4aa07f55f89620c7929757d183dae98179.zip"; sha256 = "8f73043a4b380d412288d1593c687823475f14319441b71d4457cc3fae9ff9cb"; urls = [ "https://nexus.inuits.io/repository/composer/symfony/polyfill-uuid/v1.23.0/symfony-polyfill-uuid-v1.23.0.zip" ]; }
    { name = "symfony_service-contracts-2.4.0.0"; filename = "symfony/service-contracts/0c17599b3704c92f53b07df3df1267aa83dff66f.zip"; sha256 = "3e6c0e0b3831b43c46b8ef84ddd3f549bcadc724ecf1976d526330a96a1ea7c4"; urls = [ "https://nexus.inuits.io/repository/composer/symfony/service-contracts/v2.4.0/symfony-service-contracts-v2.4.0.zip" ]; }
    { name = "twig_twig-3.3.2.0"; filename = "twig/twig/48d2f771262f85586c973ac86d7e2e49bdea09c2.zip"; sha256 = "1d6b7aa4329d85c359caf7769c274dbde06773c5ba82240f90ff2cbd8ee50740"; urls = [ "https://nexus.inuits.io/repository/composer/twig/twig/v3.3.2/twig-twig-v3.3.2.zip" ]; }
    { name = "sserbin_twig-linter-9999999-dev"; filename = "sserbin/twig-linter/ab62d76addaa547e875f7859d0d08e6d5a667534.zip"; sha256 = "3cb1e0921b7cbc732050c2b62b1b3bc7088b1ffed9646353f80a6bf7d428eb51"; urls = [ "https://nexus.inuits.io/repository/composer/sserbin/twig-linter/dev-master/sserbin-twig-linter-dev-master.zip" ]; }
    { name = "symfony_console-5.3.0.0"; filename = "symfony/console/d7219deb068d9fa41f5d28e696bdefc53af967b7.zip"; sha256 = "9cae1792e287a2fcc978a7fb74045f0749f04e926f2d722fd934ce79d0447a33"; urls = [ "https://nexus.inuits.io/repository/composer/symfony/console/v5.3.0/symfony-console-v5.3.0.zip" ]; }
    { name = "symfony_finder-5.3.0.0"; filename = "symfony/finder/911cf489005a55dcad7c7d87f60ba43f0b781c3a.zip"; sha256 = "d5381bd77ce45a2a7bfe49ce584e16389fbdf60c05b0955e38a32b5c66e7fe3c"; urls = [ "https://nexus.inuits.io/repository/composer/symfony/finder/v5.3.0/symfony-finder-v5.3.0.zip" ]; }
    { name = "symfony_polyfill-intl-grapheme-1.23.0.0"; filename = "symfony/polyfill-intl-grapheme/aa5859818f02b56a333e7300e747e80a29fa444e.zip"; sha256 = "c39d53a7193da41316ec11f863a32b6bb53e4dc1e18fbc85ac059529b2deafb5"; urls = [ "https://nexus.inuits.io/repository/composer/symfony/polyfill-intl-grapheme/v1.23.0/symfony-polyfill-intl-grapheme-v1.23.0.zip" ]; }
    { name = "symfony_polyfill-intl-normalizer-1.23.0.0"; filename = "symfony/polyfill-intl-normalizer/b0949363eda1f2c71bcd74debdd7934aa8b7ea99.zip"; sha256 = "036a4eaf320e52e8f987ac6c134c9c1cc362efedf445e5d7130d60006cecc0b0"; urls = [ "https://nexus.inuits.io/repository/composer/symfony/polyfill-intl-normalizer/v1.23.0/symfony-polyfill-intl-normalizer-v1.23.0.zip" ]; }
    { name = "symfony_string-5.3.0.0"; filename = "symfony/string/1a433eefcbb4ce2224efe3acd0ea774b8db921f0.zip"; sha256 = "88b88bf15b282b2f683a5aa160bd16e8349c9b5bdc88c751ed045bc79d121770"; urls = [ "https://nexus.inuits.io/repository/composer/symfony/string/v5.3.0/symfony-string-v5.3.0.zip" ]; }
  ];

  # Shell snippet to collect all project dependencies.
  collectCacheScript = writeText "collect-cache.sh" (
    concatMapStrings (args: ''
      (
        cacheFile=${escapeShellArg args.filename}
        cacheFilePath="$COMPOSER_CACHE_DIR/files/$cacheFile"
        mkdir -p "$(dirname "$cacheFilePath")"
        cp ${escapeShellArg (fetcher args)} "$cacheFilePath"
      )
    '') cacheEntries
  );

in stdenv.mkDerivation {
  name = "zarybnicky_tkolymp.cz";
  inherit src;

  # Make sure the build uses the right PHP version everywhere.
  # Also include unzip for Composer.
  buildInputs = [ php unzip ];

  # Defines the shell alias to run Composer.
  postHook = ''
    composer () {
      php "$NIX_COMPOSER_PATH" "$@"
    }
  '';

  configurePhase = ''
    runHook preConfigure

    # Set the cache directory for Composer.
    export COMPOSER_CACHE_DIR="$NIX_BUILD_TOP/.composer/cache"

    # Build the cache directory contents.
    source ${collectCacheScript}

    # Store the absolute path to Composer for the 'composer' alias.
    export NIX_COMPOSER_PATH="$(readlink -f ${escapeShellArg composerPath})"

    # Run normal Composer install to complete dependency installation.
    composer install

    runHook postConfigure
  '';

  buildPhase = ''
    runHook preBuild
    runHook postBuild
  '';

  installPhase = ''
    runHook preInstall

    mkdir -p $out/libexec $out/bin

    # Move the entire project to the output directory.
    mv $PWD "$out/libexec/$sourceRoot"
    cd "$out/libexec/$sourceRoot"

    # Update the path to Composer.
    export NIX_COMPOSER_PATH="$(readlink -f ${escapeShellArg composerPath})"

    # Invoke a plugin internal command to setup binaries.
    composer nixify-install-bin "$out/bin"

    runHook postInstall
  '';

  passthru = {
    inherit php;
  };
}
